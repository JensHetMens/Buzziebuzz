<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <script src="https://cdn.jsdelivr.net/npm/tronweb@2.10.1/dist/TronWeb.js"></script>



    </head>
    <body>
        <script>    
var newResult = 0;


const HttpProvider = TronWeb.providers.HttpProvider;
const fullNode = new HttpProvider("https://api.shasta.trongrid.io");
const solidityNode = new HttpProvider("https://api.shasta.trongrid.io");
const eventServer = new HttpProvider("https://api.shasta.trongrid.io");
const privateKey = "b05250bebec02caee5b2833141b10d7994f72cd8e36b7d156eda7be9ead918e8"; // test 1 private key
const test1 = "TRN8VHtkLAKTdzZRKUGpcaFQ4w5cf8hCEu"; // test wallet
const developer = "TJ3LhY1aW8ZMLNt4AFaB3XDV3JUauEakUz"; // wallet; fees
const tronWeb = new TronWeb(fullNode,solidityNode,eventServer,privateKey);






var time = 0;
var maxTry = 10;
var seondsInterval = 1;
var PK = 'b05250bebec02caee5b2833141b10d7994f72cd8e36b7d156eda7be9ead918e8'; // private key of programming address
var contractAddress = "TEXcBaw1Fq7TH4hy4pvZULzo1YVLERk9Ti"; //AHAGHAHAH
const ownerAddress = 'TRN8VHtkLAKTdzZRKUGpcaFQ4w5cf8hCEu'; // to be changed to the address where tronhero contract investment is donr
// Schedule tasks to be run on the server.





















var account;
var prev_account;
var fullContract;


async function loadTronWeb() {
    if (typeof (window.tronWeb) === 'undefined'){
        setTimeout(loadTronWeb, 1000)
        toastAlert("E R R O R");
    } else {
        fullContract = await tronWeb.contract().at(contractAddress);
        setTimeout(function (){
            startLoop()
        }, 1000);
        
    }
}


const CONTRACT_ADDRESS = "TDTwrJrprz3oHbmuCidnQus7Kzn5tENzyi";

const FROM_ADDRESS = "TRN8VHtkLAKTdzZRKUGpcaFQ4w5cf8hCEu";
const FROM_PRIVATE_KEY = "b05250bebec02caee5b2833141b10d7994f72cd8e36b7d156eda7be9ead918e8";


async function test() {


    var contractInfo = await tronWeb.trx.getContract(CONTRACT_ADDRESS);
    var contractInstance = await tronWeb.contract(contractInfo.abi.entrys, contractInfo.contract_address);

    var name = await contractInstance.name().call();
    console.log(name);  



}


test()


// test 1 mn bal
function getBalance(){
    tronWeb.trx.getBalance(test1).then(result => console.log(result / 1000000 ))
};
                
getBalance()

// test 2 contract data

tronWeb.trx.getContract(contractAddress).then(console.log)





//Functie triggerSmartContract invest

function Invest(){
    
    
 
    var parameter = [{type:'uint256',value:20536}]
    
    var options = {
        Permission_id:2,
        feeLimit: 1000000000,
        shouldPollResponse: true
    }
   
    tronWeb.transactionBuilder.triggerSmartContract(tronWeb.address.toHex(contractAddress),"invest()", options,parameter,tronWeb.address.toHex(ownerAddress)).then(result => {

        tronWeb.trx.multiSign(result.transaction, PK,2).then(signedtx => {
            // console.log(signedtx);
            tronWeb.trx.sendRawTransaction(signedtx).then(result1 => {
                console.log(result1);
                var ts = Math.round((new Date()).getTime() / 1000);
                if(result1.code == 'SERVER_BUSY' && ts < (1609474704 + 3) ){
                    time = 1;
                    Invest();
                    
                }
                console.log( result1.transaction.raw_data.contract[0].parameter);
                if(time < maxTry){
                    console.log('trying for ' + time);
                    time = time + 1;

                    // setTimeout(function(){
                        // withdrawFromTronHero();
                    // }, seondsInterval * 500);
                }
                setTimeout(function(){
                tronWeb.trx.getUnconfirmedTransactionInfo(result1.txid).then(res => { 
                    console.log(res);
                    if(res.receipt.result != 'SUCCESS'){
                        if(time < maxTry){
                            console.log('trying for ' + time);
                            time = 10;
                        }
                    }
                } ).catch(err => console.log(err));

            }, 5 * 1000);
            }).catch(error => { console.log(error)});
        }).catch(error => {
            console.log(error)
        });
    }).catch(err => console.log(err));

   

    if(time < maxTry){
        console.log('trying for ' + time);
        time = time + 1;
        setTimeout(function(){
            Invest();
        }, 200);
    }

}

    


        












           
            
            
        </script>

    <input type="button" id="btnClick" value="Invest" onclick="Invest();" >
    </body>
</html>